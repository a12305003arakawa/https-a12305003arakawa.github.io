<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é›†åˆæ™‚é–“èª¿æ•´ã‚¢ãƒ—ãƒª</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">

<style>

/* âœ… æ¨ªã¯ã¿å‡ºã—å®Œå…¨é˜²æ­¢ã€æœ€é‡è¦ã€‘ */
* {
  box-sizing: border-box;
}

body {
  font-family: "Noto Sans JP", sans-serif;
  background: #f4f4f4;
  text-align: center;
  padding: 20px;
}

.box {
  background: white;
  padding: 22px;
  max-width: 420px;
  width: 100%;
  margin: auto;
  border-radius: 14px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

/* âœ… ãƒ©ãƒ™ãƒ«ï¼ˆã‚¯ãƒªãƒƒã‚¯å¯¾å¿œï¼‰ */
label {
  display: block;
  text-align: left;
  font-weight: 700;
  margin-top: 12px;
  margin-bottom: 6px;
  cursor: pointer;
}

/* âœ… å…¥åŠ›æ¬„ï¼ˆæ¨ªãƒ”ãƒƒã‚¿ãƒªå¯¾å¿œï¼‰ */
input {
  padding: 12px;
  font-size: 16px;
  width: 100%;
  max-width: 100%;
  border-radius: 8px;
  border: 1px solid #ccc;
}

/* âœ… å…±é€šãƒœã‚¿ãƒ³ */
button {
  padding: 12px 0;
  margin-top: 16px;
  width: 100%;
  border: none;
  background: #ddd;
  border-radius: 10px;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
}

/* âœ… é¸æŠä¸­ãƒœã‚¿ãƒ³ */
button.selected {
  background: #4CAF50;
  color: white;
}

/* âœ… æœ‰åŠ¹çŠ¶æ…‹ãƒœã‚¿ãƒ³ */
button.ready {
  background: #4CAF50;
  color: white;
}

#finalTime {
  font-size: 42px;
  font-weight: 700;
}

#shareLink {
  color: blue;
  word-break: break-all;
  user-select: all;
}

/* âœ… è³ªå•ãƒ–ãƒ­ãƒƒã‚¯ */
.question {
  margin-top: 22px;
}

</style>
</head>
<body>

<!-- âœ… ãƒ›ã‚¹ãƒˆ -->
<div id="host" class="box">
  <h2>é›†åˆæ™‚é–“èª¿æ•´ãã‚“</h2>

  <label for="hostDate">æ—¥ä»˜</label>
  <input type="date" id="hostDate">

  <label for="hostTime">é›†åˆæ™‚é–“</label>
  <input type="time" id="hostTime">

  <label for="hostPlace">é›†åˆå ´æ‰€</label>
  <input type="text" id="hostPlace" placeholder="ä¾‹ï¼šæ¸‹è°·é§…ãƒãƒå…¬å‰">

  <label for="hostMemo">è¿½è¨˜ï¼ˆä»»æ„ï¼‰</label>
  <input type="text" id="hostMemo" placeholder="ä¾‹ï¼šé›¨å¤©æ±ºè¡Œ">

  <button id="createBtn" onclick="createLink()">ãƒªãƒ³ã‚¯ä½œæˆ</button>
  <p id="shareLink"></p>
</div>

<!-- âœ… è¨ºæ–­ -->
<div id="user" class="box" style="display:none;">
  <h2>æ€§æ ¼ãƒ»ä½“èª¿è¨ºæ–­</h2>

  <div class="question">
    <p>Q1ï¼šå¾…ã¡åˆã‚ã›ã«ã¯ã„ã¤ç€ãã“ã¨ãŒå¤šã„ï¼Ÿ</p>
    <button onclick="selectAnswer(this,0,2)">å°‘ã—æ—©ã‚</button>
    <button onclick="selectAnswer(this,0,0)">ã ã„ãŸã„ã¡ã‚‡ã†ã©</button>
    <button onclick="selectAnswer(this,0,-2)">ã‚®ãƒªã‚®ãƒª / é…ã‚Œã‚‹</button>
  </div>

  <div class="question">
    <p>Q2ï¼šæ˜¨æ—¥ã¯ã‚ˆãå¯ã‚‰ã‚ŒãŸï¼Ÿ</p>
    <button onclick="selectAnswer(this,1,2)">ã—ã£ã‹ã‚Šå¯ãŸ</button>
    <button onclick="selectAnswer(this,1,0)">ã¾ã‚ã¾ã‚</button>
    <button onclick="selectAnswer(this,1,-2)">ã»ã¨ã‚“ã©å¯ã¦ãªã„</button>
  </div>

  <div class="question">
    <p>Q3ï¼šä»Šã®èª¿å­ã¯ï¼Ÿ</p>
    <button onclick="selectAnswer(this,2,2)">ã‚ã£ã¡ã‚ƒå…ƒæ°—</button>
    <button onclick="selectAnswer(this,2,0)">ãµã¤ã†</button>
    <button onclick="selectAnswer(this,2,-2)">æ­£ç›´ã—ã‚“ã©ã„</button>
  </div>

  <div class="question">
    <p>Q4ï¼šç§»å‹•ã®ã¨ãã¯ï¼Ÿ</p>
    <button onclick="selectAnswer(this,3,2)">ä½™è£•ã‚’ã‚‚ã¤</button>
    <button onclick="selectAnswer(this,3,0)">ã„ã¤ã‚‚é€šã‚Š</button>
    <button onclick="selectAnswer(this,3,-2)">ã‚®ãƒªã‚®ãƒª</button>
  </div>

  <div class="question">
    <p>Q5ï¼šä»Šå›ã¯é…ã‚Œãã†ãªä¸å®‰ã‚ã‚‹ï¼Ÿ</p>
    <button onclick="selectAnswer(this,4,1)">ãªã„</button>
    <button onclick="selectAnswer(this,4,0)">å°‘ã—</button>
    <button onclick="selectAnswer(this,4,-2)">ã‹ãªã‚Šã‚ã‚‹</button>
  </div>

  <div class="question">
    <p>Q6ï¼šä»Šã®ã‚„ã‚‹æ°—ã¯ï¼Ÿ</p>
    <button onclick="selectAnswer(this,5,2)">ã‚ã£ã¡ã‚ƒã‚ã‚‹</button>
    <button onclick="selectAnswer(this,5,0)">ãµã¤ã†</button>
    <button onclick="selectAnswer(this,5,-2)">ã‚ã‚“ã¾ã‚Šâ€¦</button>
  </div>

  <div class="question">
    <p>Q7ï¼šæœ€è¿‘ã€æ™‚é–“ã«ãƒ«ãƒ¼ã‚ºï¼Ÿ</p>
    <button onclick="selectAnswer(this,6,2)">ãªã£ã¦ãªã„</button>
    <button onclick="selectAnswer(this,6,0)">ãŸã¾ã«</button>
    <button onclick="selectAnswer(this,6,-2)">ã‹ãªã‚Š</button>
  </div>

  <button id="resultBtn" onclick="showResult()" disabled>çµæœã‚’è¦‹ã‚‹</button>
</div>

<!-- âœ… çµæœ -->
<div id="result" class="box" style="display:none;">
  <h2>ã‚ãªãŸã®é›†åˆæ™‚é–“</h2>
  <p id="finalDate"></p>
  <h1 id="finalTime"></h1>
  <p id="finalPlace"></p>
  <p id="finalMemo"></p>
  <p id="typeText"></p>
</div>

<script>

let baseTime="", baseDate="", basePlace="", baseMemo="";
let answers=[null,null,null,null,null,null,null];

// âœ… å…¥åŠ›å®Œäº†ã§ãƒªãƒ³ã‚¯ä½œæˆãƒœã‚¿ãƒ³ON
document.querySelectorAll("#host input").forEach(el=>{
  el.addEventListener("input", ()=>{/* âœ… æ—¥ä»˜ãƒ»æ™‚é–“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸç¬é–“ã«é–‹ã */
document.addEventListener("DOMContentLoaded", () => {
  const dateInput = document.getElementById("hostDate");
  const timeInput = document.getElementById("hostTime");

  if (dateInput.showPicker) {
    dateInput.addEventListener("click", () => dateInput.showPicker());
  }

  if (timeInput.showPicker) {
    timeInput.addEventListener("click", () => timeInput.showPicker());
  }
});
    if(hostDate.value && hostTime.value && hostPlace.value){
      createBtn.classList.add("ready");
    }else{
      createBtn.classList.remove("ready");
    }
  });
});

// âœ… ãƒªãƒ³ã‚¯ä½œæˆ
function createLink(){
  const d = hostDate.value;
  const t = hostTime.value;
  const p = hostPlace.value;
  const m = hostMemo.value;

  if(!d || !t || !p){
    alert("æ—¥ä»˜ãƒ»æ™‚é–“ãƒ»å ´æ‰€ã¯å¿…é ˆã§ã™");
    return;
  }

  const safe = encodeURIComponent(`${d}|${t}|${p}|${m}`);
  const encoded = btoa(safe);
  const url = location.href.split("?")[0] + "?t=" + encoded;

  shareLink.innerText = url;
}

// âœ… é¸æŠå‡¦ç†
function selectAnswer(btn,index,val){
  const buttons = btn.parentElement.querySelectorAll("button");
  buttons.forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");

  answers[index]=val;
  resultBtn.disabled = answers.includes(null);
  if(!resultBtn.disabled) resultBtn.classList.add("ready");
}

// âœ… çµæœè¡¨ç¤º
function showResult(){
  const score = answers.reduce((a,b)=>a+b,0);
  let adjust=score>=6?0:(score<=-6?-30:-10);

  let [h,m]=baseTime.split(":").map(Number);
  let total=h*60+m+adjust;

  let nh=Math.floor((total+1440)%1440/60);
  let nm=(total+1440)%60;

  finalTime.innerText=`${String(nh).padStart(2,"0")}:${String(nm).padStart(2,"0")}`;
  finalDate.innerText="æ—¥æ™‚ğŸ“…ï¼š "+baseDate;
  finalPlace.innerText="é›†åˆå ´æ‰€ğŸ“ï¼š "+basePlace;
  finalMemo.innerText=baseMemo ? ""+baseMemo : "";
  typeText.innerText =
    adjust===0 ? "ä»Šå›ã¯ä½™è£•ã‚ã‚Šï¼" :
    adjust===-10 ? "å°‘ã—æ—©ã‚è¡Œå‹•ãŒãŠã™ã™ã‚" :
    "ã‹ãªã‚Šæ—©ã‚ã®è¡Œå‹•æ¨å¥¨ï¼";

  user.style.display="none";
  result.style.display="block";
}

// âœ… URLå—ä¿¡
const params=new URLSearchParams(location.search);
const encoded=params.get("t");
if(encoded){
  const decoded=decodeURIComponent(atob(encoded));
  const parts=decoded.split("|");

  baseDate=parts[0];
  baseTime=parts[1];
  basePlace=parts[2];
  baseMemo=parts[3]||"";

  host.style.display="none";
  user.style.display="block";
}
</script>

</body>
</html>
